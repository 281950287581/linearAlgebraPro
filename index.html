<html>

<head>
    <meta charset="utf8" />
</head>

<body>
    <canvas id="myCanvas"></canvas>
</body>

</html>

<script>
    // 序列对象
    // 1.生成数列
    // 2.求逆序数
    var Sequence = function (number) {
        this.number = number
        this.inverseCount = calcInverseNumber(this.number)
    }

    // 生成全排列
    // 全排列: 把n个不同的元素(1~n)排成一列
    // @digit n
    // @return 1~n随机排成的数组
    function generateNumbers(digit) {
        var arr = []
        for (var i = 1; i <= digit; i++) {
            arr.push(i)
        }
        var newArr = []

        while (arr.length) {
            newArr.push(arr.splice(Math.ceil(Math.random() * arr.length - 1), 1)[0])
        }

        return newArr
    }

    // 计算全排列的逆序数
    // @number [1,3,2,4]
    // @return count the inverse of @number
    function calcInverseNumber(number) {
        var sum = 0
        for (var i = 0, len = number.length; i < len; i++) {
            var digit = number[i]
            for (var j = i + 1; j < len; j++) {
                if (digit > number[j]) {
                    sum++
                }
            }
        }
        return sum
    }

    // 阶乘n!
    // @return n*(n-1)*...*3*2*1
    function factorial(n) {
        var result = 1
        for (i = 2; i <= n; i++) {
            result *= i
        }
        return result
    }

    function regCheck(reg, str) {
        var re = new RegExp(reg);
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    }

    function isDigit(number) {
        return regCheck(/^[0-9]+$/g, number)
    }

</script>

<script>
    // 行列式 determinant
    /** 
        data = 
            [
                [a11, a12, a13],
                [a21, a22, a23],
                [a31, a32, a33]
            ]
            det(a_ij)
    */
    var Determinant = function (data) {
        this.data = data
    }

    // 计算行列式的值
    /*
        @data [
            [1, 2, 5],
            [1, 3, -2],
            [2, 5, 3]
        ]

        @return the value of @data
    */
    function calcDeterminant(data) {
        var n = data.length
        var number = generateNumbers(n) //标准序列
        var sum = []
        permute(sum, number, 0, n - 1)
        var inverses = sum.map(function (item) {
            return calcInverseNumber(item)
        })

        var resultSum = 0
        for (var i = 0, len = factorial(n); i < len; i++) {
            var arr_j = sum[i]
            var inverseCount = inverses[i]
            var result = 1

            var k = 0
            arr_j.forEach(function (column) {
                result *= data[k][column - 1]
                k++
            })

            // 偶排列、奇排列
            resultSum += (inverseCount % 2 ? -1 : 1) * result
        }

        return resultSum
    }

    /*
        交互数组中的两个元素

    */
    function swap(arr, i, j) {
        var temp = arr[i]
        arr[i] = arr[j]
        arr[j] = temp
        return arr
    }

    /**
        计算标准序列的所有全排列,结果放入sum. permutation
        最好是10以下的排列, 不然会算很久.

        @sum 结果数组, 一个空数组, 最后数组长度为n!
        @arr 全排列数组
        @start Starting index of the @arr
        @end Ending index of the @arr
    */
    // https://www.geeksforgeeks.org/write-a-c-program-to-print-all-permutations-of-a-given-string/
    function permute(sum, arr, start, end) {
        if (start == end) {
            sum.push(arr.slice(0))
        }
        else {
            for (var i = start; i <= end; i++) {
                swap(arr, start, i)
                permute(sum, arr, start + 1, end)
                swap(arr, start, i)
            }
        }
    }

    let count = 0
    // https://en.wikipedia.org/wiki/Heap%27s_algorithm
    function generate(n, A) {
        if (n == 1) {
            count++
            // return A
            console.log(A)
        }
        else {
            for (let i = 0; i < n - 1; i++) {
                generate(n - 1, A)
                if (n % 2 == 0) {
                    swap(A, i, n - 1)
                }
                else {
                    swap(A, 0, n - 1)
                }
            }
            generate(n - 1, A)
        }
    }
</script>

<script>

    var number = generateNumbers(9)
    var s = new Sequence(number)
    var sum = []
    permute(sum, number, 0, number.length - 1)
    var inverses = sum.map(function (item) {
        return calcInverseNumber(item)
    })


</script>